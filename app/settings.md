# 异物侵限

## Version
- v4.3.0

## Feature
- 铁路线路障碍扫描预警告警
- 视频

## 页面构成
- 登录
- 主页
  - 活动告警
    - 告警搜索 （输入条件）
      - 告警详情
    - 告警详情
      - 告警图片
      - 高清图片
      - 实时视频预览(HikVision)
      - 告警历史视频(*.mp4)
  - 监控点浏览
    - 局列表
      - 站点列表
        - 站点详情
        - 单元列表
          - 单元详情
            - 浏览图片
            - 高清图片
            - 实时视频预览(HikVision)
  - 我的
    - 退出登录

## 功能实现记录
- 集成了开源的ProgressWheel，替代ProgressBar，实现Material Design效果
- 雷达数据View， 使用矩阵
- 可缩放图片控件：
  - DragImageView   图片变形
  - ZoomImageView   
  - TouchImageView  没毛病，完美  **最终选用**
  - PhotoView       听说还行，但还没用
- 时间选择框：
  - dtchooser-debug.aar
- 加密：
  - base64
- 单元详情页面/告警详情页面的状态信息显示：
 ~~~
 1 通过返回的code,查询对应的CodeName： 展示对应的CodeName  其实是由（CodeName : codeValue）拼接而成，
     后续如果需要改成pc端的样式，则需要添加title，和name分开展示：title对应：CodeName，name对应codeValue。
 2 通过返回的code,查询对应的GroupId， 判断字体颜色：
     <5,表示异常，显示红色字体；>=5 表示正常，显示黑色字体
     例外：UpAlarmState,  DownAlarmState  ==10 ，表示正常，显示黑色字体； 其他都是异常，显示红色字体
 ~~~
 - 发送控制指令的接口：
   ~~~
   Code：德佳已经发了，写到了Finals里了；
   No: 每次请求随即生成一个1-65535之间的整数
   ~~~
- 以下模块屏蔽：
  ~~~
  1. UpdateDownloadService 升级模块，检查版本更新
  
  ~~~
- 绘制自定义雷达view，可缩放平移
  - 时间：2018.8.4
  ~~~ 
  步骤：
  1. 根据某id下载.ld, .obj, .param 3个文件 http
  2. 文件转byte[]
  3. 解析byte[]生成List、Bean
  4. 自定义view
  ~~~


------------- 2016-09-06 --------------

## 待完善
- 加载框----是否可以返回键取消掉？
- 雷达绘制View，需要修改绘制方法和节点，参照assets里的截图

## 问题解决记录
- EventBus发送的消息，多次接收
  ~~~
  EventBus.getDefault().removeStickyEvent()
  ~~~
- 集成：GreenDao， 遇到报错：no such table
  ~~~
  解决：可能是因为同一个版本，不停的部署到同一个手机上，中途未卸载，导致表未创建上。
  ~~~
- 对于上行参数的值为空时的处理：
  ~~~
  空字段，传 0 (优先) 或者 ""
  ~~~
- 推送消息的几种类型的处理方式：
  ~~~
  1. 弹出通知栏消息的： 有新告警
  2. 相关页面弹出Toast，请求接口刷新页面的：发送各种控制命令的，需要刷新相关的状态，
  3. 相关页面弹出Toast/对话框： 图片来了。
  ~~~ 
- vector assets 图片颜色：
  - android5.0以下全是黑色, 5.0及以上，才会解析自定义的颜色。

- 2018.9.x app已修改内容：
  ~~~
  1. 监控点各层级页面传递的参数：StationBean  UnitBean， 都包含工区id，工务段id。
  2. 监控点详情页和监控单元详情页，都做了容错处理，对返回报文，判断是否是当前的stnId(或者unitId)
  3. 主页 - 监控点Framgent, 如果显示的站点这一级，点击返回键，返回局一级列表。
  4. 告警列表布局
  5. Toast位置居中
  6. 其他小优化
  7. server addr： 121.18.76.102:5546
  ~~~
- 2018.12.7 李亚周提出问题
  - 偶尔有时会出现：雷达数据绘制失败： RadarView绘制错误，点集中在一处
    +  需要协调zzx修改雷达数据解析协议
    + zzx的接口并未返回告警目标数据
    
- 2019.4.13 功能修改，接口变了。
  ~~~
  1） 提出人：赵肖良， 赵中祥， 李亚周
  2） 描述： 由于系统前台更换了雷达设备型号，雷达上传的数据点规格发生变化：
     - 老雷达：一共传了360个点，步进：0.5度，
     - 新雷达：一共传了720个点，步进：0.25度，
     - 修改了算法：
     - ![alt text](app/src/main/assets/zzx_calc_shot.png "Title"
     - 尚未修改完
  ~~~
    
- 2020.10.19 加需求：
  ~~~
  1. 添加视频：
     实时视频  due to HikVision SDK
     历史视频  .mp4 视频流
  2. Http -->  Https OpenSSL加密校验
  3. 修改版本号为：4.3.0
  ~~~
  